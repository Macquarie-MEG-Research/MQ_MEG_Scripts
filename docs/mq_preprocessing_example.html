<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="MATLAB R2016a"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><title>Welcome to the Macquarie MEG Tutorial! </title><style type="text/css">
* {margin: 0; padding: 0;}
body {text-align: start; line-height: 17.234001159668px; min-height: 0px; white-space: normal; color: rgb(0, 0, 0); font-family: Consolas, Inconsolata, Menlo, monospace; font-style: normal; font-size: 14px; font-weight: normal; text-decoration: none; white-space: normal; }
h1, h2 {font-weight: normal;}
.content { padding: 30px; }

.S0 { margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S1 { line-height: 26.3999996185303px; min-height: 24px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-size: 22px; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 15px; margin-right: 10px;  }
.S2 { min-height: 0px; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S3 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S4 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 15px; margin-bottom: 9px; margin-right: 10px;  }
.S5 { text-align: center; line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S6 { font-family: Helvetica, Arial, sans-serif; margin-left: 0px; margin-top: 10px; margin-bottom: 20px; margin-right: 0px;  }
.S7 { text-align: left; line-height: 21px; white-space: pre-wrap; white-space: pre-wrap; margin-left: 56px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S8 { color: rgb(0, 95, 206); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S9 { margin-left: 3px; margin-top: 10px; margin-bottom: 4px; margin-right: 3px;  }
.S10 { line-height: 15.5926675796509px; min-height: 18px; white-space: nowrap; font-size: 12.6666669845581px; white-space: nowrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S11 { line-height: 15.5926685333252px; min-height: 0px; white-space: pre; color: rgb(34, 139, 34); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S12 { line-height: 15.5926685333252px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S13 { line-height: 15.5926685333252px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S14 { line-height: 15.5926685333252px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S15 { line-height: 15.5926685333252px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S16 { min-height: 0px; font-family: monospace; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S17 { line-height: 15.5926685333252px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S18 { min-height: 0px; font-weight: bold; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }

.LineNodeBlock {margin: 10px 0 10px 0;}
.LineNodeBlock+.paragraphNode {margin-top: 10px;}
.lineNode {padding-left: 10px; background-color: #F7F7F7; border-left: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.inlineWrapper:first-child .lineNode,.inlineWrapper.outputs+.inlineWrapper .lineNode {padding-top: 5px; border-top: 1px solid #E9E9E9;}
.inlineWrapper:last-child .lineNode,.inlineWrapper.outputs .lineNode {padding-bottom: 5px; border-bottom: 1px solid #E9E9E9;}
.lineNode .textBox {white-space: pre;}
</style></head><body><div class = "content"><div class = 'SectionBlock containment active'><h1 class = "S1"><span class = "S2">Welcome to the Macquarie MEG Tutorial! </span></h1><p class = "S3"><span class = "S2">This tutorial will guide you through the basic preprocessing steps of MEG analysis, for data acquired from the KIT-Macquarie Research Laboratory.   </span></p><h2 class = "S4"><span class = "S2">Experimental Paradigm</span></h2><p class = "S3"><span class = "S2">A static simple visual grating (2 cycles per degree) is presented to participants. There is 2s baseline before each presentation of the visual grating</span></p><p class = "S5"><img class="imageNode" width="208" height="145" style="vertical-align: baseline" src="data:image/png;base64,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
uP0fP4EnDTcASXgAAAAASUVORK5CYII="></p></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">The first step will be set up the paths on your machine. </span></p><p class = "S3"><span class = "S2">You will need to following toolbox, which can be downloaded from Github </span></p><ul class = "S6"><li class = "S7"><a href = 'http://www.fieldtriptoolbox.org/'><span class = "S0">Fieldtrip Toolbox</span></a></li><li class = "S7"><a href = 'https://github.com/Macquarie-MEG-Research/MQ_MEG_Scripts'><span class = "S0">MQ_MEG_Scripts</span></a></li></ul><p class = "S3"><span class = "S2">You will also need to download the sample MEG data from:</span></p><ul class = "S6"><li class = "S7"><span class = "S0">???</span></li></ul><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 1. Set up paths</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Path to the raw data (make sure this ends with /)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">data_path   = </span><span class = "S14">'/Volumes/Robert T5/sample_data/'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Path to where the data should be saved (make sure this ends with /)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">save_path   = </span><span class = "S14">'/Volumes/Robert T5/sample_data_processed/'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Path to the Fieldtrip Toolbox</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">path_to_fieldtrip = </span><span class = "S14">'/Users/rseymoue/Documents/GitHub/fieldtrip'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Path to MQ_MEG_Scripts</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">path_to_MQ_MEG_Scripts = </span><span class = "S14">'/Users/rseymoue/Documents/GitHub/MQ_MEG_Scripts/'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">We now need to add MQ_MEG_Scripts an  to your MATLAB path</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 2. Add Fieldtrip and MQ_MEG_Scripts to path</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">addpath(path_to_fieldtrip);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">ft_defaults</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">warning([</span><span class = "S14">'Please note that MQ_MEG_Scripts is designed for'</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S14">' MATLAB 2016b or later and have been tested using Fieldtrip'</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S14">' version 20181213'</span><span class = "S12">]);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">addpath(genpath(path_to_MQ_MEG_Scripts));</span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">Now we need to specify the subject ID </span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 3. Specifiy Subject ID</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">subject = </span><span class = "S14">'3566'</span><span class = "S12">;</span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">I prefer to separate the 'raw' data folder from the 'processed' data folder, mainly so I don't accidently erase the raw data, but also so we don't end up with a large folder with mixture of disorganised  </span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 4. Make a subject specific results folder for saving</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Get the path to the saving directory</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">dir_name = [save_path subject];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Make the directory!</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">mkdir(dir_name);</span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">We now need to specify the path to the .con, .mrk, .elp and .hsp files</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 5. Specify paths to confile, mrkfile, elpfile and hspfile</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">confile = [data_path </span><span class = "S14">'sub-' </span><span class = "S13">subject </span><span class = "S14">'/ses-1/meg/sub-' </span><span class = "S13">subject</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S14">'_ses-1_task-alien_run-1_meg.con'</span><span class = "S12">];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">mrkfile = [data_path </span><span class = "S14">'sub-' </span><span class = "S13">subject</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S14">'/ses-1/meg/sub-' </span><span class = "S13">subject </span><span class = "S14">'_ses-1_task-alien_run-1_markers.mrk'</span><span class = "S12">];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Find files ending in .elp (if you have more than one .elp file you will need</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% to modify this code)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">elpfile = dir([data_path </span><span class = "S14">'sub-' </span><span class = "S13">subject</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S14">'/ses-1/extras/*.elp'</span><span class = "S12">]);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">elpfile = [elpfile.folder </span><span class = "S14">'/' </span><span class = "S12">elpfile.name];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Find files ending in .hsp (if you have more than one .hsp file you will need</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% to modify this code)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">hspfile = dir([data_path </span><span class = "S14">'sub-' </span><span class = "S13">subject</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S14">'/ses-1/extras/*.hsp'</span><span class = "S12">]);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">hspfile = [hspfile.folder </span><span class = "S14">'/' </span><span class = "S12">hspfile.name];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Get the path to the saving directory</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">dir_name = [save_path subject];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cd(dir_name);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">Sometimes the data contains saturations (periods when MEG flat-lines due to the presence of low-frequency nose. The </span><span class = "S16">mq_detect_satuations</span><span class = "S2"> function can be used to detect the channels and times with saturations</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 6. Check for saturations</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">[sat] = mq_detect_saturations(dir_name,confile)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">save </span><span class = "S17">sat sat</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">For accurate co-registration later we need to downsample the headshape information acquired before the scan. If you are not intending to perform source analysis, you can ignore this step</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 7. Downsample Headshape</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">headshape_downsampled = downsample_headshape(hspfile,</span><span class = "S14">'yes'</span><span class = "S12">,2);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">figure; ft_plot_headshape(headshape_downsampled);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Save</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cd(dir_name);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">disp(</span><span class = "S14">'Saving headshape_downsampled'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">save </span><span class = "S14">headshape_downsampled headshape_downsampled</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S18">IMPORTANT:  </span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 8. Realign Sensors</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">[grad_trans] = mq_realign_sens(dir_name,elpfile,hspfile,</span><span class = "S15">...</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    confile,mrkfile,</span><span class = "S14">''</span><span class = "S13">,</span><span class = "S14">'rot3dfit'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">print(</span><span class = "S14">'grad_trans'</span><span class = "S13">,</span><span class = "S14">'-dpng'</span><span class = "S13">,</span><span class = "S14">'-r200'</span><span class = "S12">);</span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2"></span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 9. Read in raw MEG data &amp; apply filters</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% CD to correct directory</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cd(dir_name);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Epoch the whole dataset into one continous dataset and apply</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% the appropriate filters</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.headerfile = confile;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.datafile = confile;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.trialdef.triallength = Inf;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.trialdef.ntrials = 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = ft_definetrial(cfg)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.continuous = </span><span class = "S14">'yes'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">alldata</span><span class = "S12"> = ft_preprocessing(cfg);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Band-pass filter between 0.5-250Hz to help visualisation</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.continuous = </span><span class = "S14">'yes'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.bpfilter = </span><span class = "S14">'yes'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.bpfreq = [0.5 250];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">alldata = ft_preprocessing(cfg);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Deal with 50Hz line noise using a bandstop filter</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.bsfilter = </span><span class = "S14">'yes'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.bsfreq = [49.5 50.5];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">alldata = ft_preprocessing(cfg,alldata);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Deal with 100Hz line noise using a bandstop filter</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.bsfilter = </span><span class = "S14">'yes'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.bsfreq = [99.5 100.5];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">alldata = ft_preprocessing(cfg,alldata);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Create layout file for later and save</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg             = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.grad        = alldata.grad;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">lay             = ft_prepare_layout(cfg, alldata);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">save </span><span class = "S17">lay lay</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Cut out MEG channels</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.channel = alldata.label(1:160);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">alldata = ft_selectdata(cfg,alldata);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 10. Epoch the data into trials</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg.dataset                 = confile;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.continuous              = </span><span class = "S14">'yes'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.trialdef.prestim        = 2.0;         </span><span class = "S11">% pre-stimulus interval</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.trialdef.poststim       = 2.0;        </span><span class = "S11">% post-stimulus interval</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">cfg.trialfun                = </span><span class = "S14">'mytrialfun_new_alien'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">data_raw                    = ft_definetrial(cfg);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% Redefines the filtered data</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cfg = [];</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">data = ft_redefinetrial(data_raw,alldata);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S3"><span class = "S2">Here we will </span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">% 11. Epoch the data into trials</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></p></div></div></div></div>
<!-- 
##### SOURCE BEGIN #####
%% Welcome to the Macquarie MEG Tutorial! 
% This tutorial will guide you through the basic preprocessing steps of MEG 
% analysis, for data acquired from the KIT-Macquarie Research Laboratory.   
%% Experimental Paradigm
% A static simple visual grating (2 cycles per degree) is presented to participants. 
% There is 2s baseline before each presentation of the visual grating
% 
% 
% 
% The first step will be set up the paths on your machine. 
% 
% You will need to following toolbox, which can be downloaded from Github 
% 
% * <http://www.fieldtriptoolbox.org/ Fieldtrip Toolbox>
% * <https://github.com/Macquarie-MEG-Research/MQ_MEG_Scripts MQ_MEG_Scripts>
% 
% You will also need to download the sample MEG data from:
% 
% * ???

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 1. Set up paths
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Path to the raw data (make sure this ends with /)
data_path   = '/Volumes/Robert T5/sample_data/';

% Path to where the data should be saved (make sure this ends with /)
save_path   = '/Volumes/Robert T5/sample_data_processed/';

% Path to the Fieldtrip Toolbox
path_to_fieldtrip = '/Users/rseymoue/Documents/GitHub/fieldtrip';

% Path to MQ_MEG_Scripts
path_to_MQ_MEG_Scripts = '/Users/rseymoue/Documents/GitHub/MQ_MEG_Scripts/';

%% 
% We now need to add MQ_MEG_Scripts an  to your MATLAB path

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 2. Add Fieldtrip and MQ_MEG_Scripts to path
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

addpath(path_to_fieldtrip);
ft_defaults

warning(['Please note that MQ_MEG_Scripts is designed for'...
    ' MATLAB 2016b or later and have been tested using Fieldtrip'...
    ' version 20181213']);
addpath(genpath(path_to_MQ_MEG_Scripts));
%% 
% Now we need to specify the subject ID 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 3. Specifiy Subject ID
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
subject = '3566';
%% 
% I prefer to separate the 'raw' data folder from the 'processed' data folder, 
% mainly so I don't accidently erase the raw data, but also so we don't end up 
% with a large folder with mixture of disorganised  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 4. Make a subject specific results folder for saving
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Get the path to the saving directory
dir_name = [save_path subject];
% Make the directory!
mkdir(dir_name);
%% 
% We now need to specify the path to the .con, .mrk, .elp and .hsp files

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 5. Specify paths to confile, mrkfile, elpfile and hspfile
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

confile = [data_path 'sub-' subject '/ses-1/meg/sub-' subject...
    '_ses-1_task-alien_run-1_meg.con'];

mrkfile = [data_path 'sub-' subject...
    '/ses-1/meg/sub-' subject '_ses-1_task-alien_run-1_markers.mrk'];

% Find files ending in .elp (if you have more than one .elp file you will need
% to modify this code)
elpfile = dir([data_path 'sub-' subject...
    '/ses-1/extras/*.elp']);
elpfile = [elpfile.folder '/' elpfile.name];

% Find files ending in .hsp (if you have more than one .hsp file you will need
% to modify this code)
hspfile = dir([data_path 'sub-' subject...
    '/ses-1/extras/*.hsp']);
hspfile = [hspfile.folder '/' hspfile.name];

% Get the path to the saving directory
dir_name = [save_path subject];
cd(dir_name);

%% 
% Sometimes the data contains saturations (periods when MEG flat-lines due 
% to the presence of low-frequency nose. The |mq_detect_satuations| function can 
% be used to detect the channels and times with saturations

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 6. Check for saturations
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

[sat] = mq_detect_saturations(dir_name,confile)
save sat sat

%% 
% For accurate co-registration later we need to downsample the headshape 
% information acquired before the scan. If you are not intending to perform source 
% analysis, you can ignore this step

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 7. Downsample Headshape
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

headshape_downsampled = downsample_headshape(hspfile,'yes',2);
figure; ft_plot_headshape(headshape_downsampled);

% Save
cd(dir_name);
disp('Saving headshape_downsampled');
save headshape_downsampled headshape_downsampled;

%% 
% *IMPORTANT:  *

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 8. Realign Sensors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

[grad_trans] = mq_realign_sens(dir_name,elpfile,hspfile,...
    confile,mrkfile,'','rot3dfit');

print('grad_trans','-dpng','-r200');
%% 
% 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 9. Read in raw MEG data & apply filters
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% CD to correct directory
cd(dir_name);

% Epoch the whole dataset into one continous dataset and apply
% the appropriate filters
cfg = [];
cfg.headerfile = confile;
cfg.datafile = confile;
cfg.trialdef.triallength = Inf;
cfg.trialdef.ntrials = 1;
cfg = ft_definetrial(cfg)

cfg.continuous = 'yes';
alldata = ft_preprocessing(cfg);

% Band-pass filter between 0.5-250Hz to help visualisation
cfg.continuous = 'yes';
cfg.bpfilter = 'yes';
cfg.bpfreq = [0.5 250];
alldata = ft_preprocessing(cfg);

% Deal with 50Hz line noise using a bandstop filter
cfg = [];
cfg.bsfilter = 'yes';
cfg.bsfreq = [49.5 50.5];
alldata = ft_preprocessing(cfg,alldata);

% Deal with 100Hz line noise using a bandstop filter
cfg = [];
cfg.bsfilter = 'yes';
cfg.bsfreq = [99.5 100.5];
alldata = ft_preprocessing(cfg,alldata);

% Create layout file for later and save
cfg             = [];
cfg.grad        = alldata.grad;
lay             = ft_prepare_layout(cfg, alldata);
save lay lay

% Cut out MEG channels
cfg = [];
cfg.channel = alldata.label(1:160);
alldata = ft_selectdata(cfg,alldata);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 10. Epoch the data into trials
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

cfg = [];
cfg.dataset                 = confile;
cfg.continuous              = 'yes';
cfg.trialdef.prestim        = 2.0;         % pre-stimulus interval
cfg.trialdef.poststim       = 2.0;        % post-stimulus interval
cfg.trialfun                = 'mytrialfun_new_alien';
data_raw                    = ft_definetrial(cfg);

% Redefines the filtered data
cfg = [];
data = ft_redefinetrial(data_raw,alldata);

%% 
% Here we will 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 11. Epoch the data into trials
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
##### SOURCE END #####
--></body></html>